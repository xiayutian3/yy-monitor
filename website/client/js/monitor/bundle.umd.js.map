{"version":3,"file":"bundle.umd.js","sources":["../../../../sdk/xhrHook.js","../../../../sdk/index.js"],"sourcesContent":["// 请求监控\r\n\r\nexport default {\r\n  init: (cb) => {\r\n    console.log(123)\r\n    //xhr hook \r\n    let xhr = window.XMLHttpRequest\r\n    if (xhr._yy_monitor_flag === true) {\r\n      return\r\n    }\r\n    xhr._yy_monitor_flag = true\r\n\r\n    //修改原型上的open方法\r\n    let _originOpen = xhr.prototype.open\r\n    xhr.prototype.open = function (method, url, async, user, password) {\r\n      //信息统计\r\n      this._yy_xhr_info = {\r\n        method,\r\n        url,\r\n        status: null,\r\n      }\r\n      return _originOpen.apply(this, arguments)\r\n    }\r\n\r\n    //修改原型上的send方法\r\n    let _originSend = xhr.prototype.send\r\n    xhr.prototype.send = function (value) {\r\n      let _self = this\r\n      this._yy_start_time = Date.now()\r\n\r\n      const ajaxEnd = (eventType) => () => {\r\n        if (_self.response) {\r\n          let responseSize = null\r\n          switch (_self.responseType) {\r\n            case 'json':\r\n              // JSON兼容性问题 && stringify报错\r\n              responseSize = JSON.stringify(_self.response).length;\r\n              break;\r\n            case 'arraybuffer':\r\n              responseSize = _self.response.byteLength\r\n              break;\r\n            default:\r\n              responseSize = _self.responseText.length\r\n              break;\r\n          }\r\n          //统计信息，扩展信息\r\n          _self._yy_xhr_info.event = eventType\r\n          _self._yy_xhr_info.status = _self.status\r\n          _self._yy_xhr_info.success = _self.status === 200\r\n          _self._yy_xhr_info.duration = Date.now() - _self._yy_start_time\r\n          _self._yy_xhr_info.responseSize = responseSize\r\n          _self._yy_xhr_info.requestSize = value ? value.length : 0  //Todo value不一定有length\r\n          _self._yy_xhr_info.type = 'xhr'\r\n\r\n          // 上报数据\r\n          cb(_self._yy_xhr_info)\r\n\r\n        }\r\n      }\r\n\r\n      //这三种状态都代表请求已经结束了，需要统计一些信息，并上报上去\r\n      this.addEventListener('load', ajaxEnd('load'), false); //成功\r\n      this.addEventListener('error', ajaxEnd('error'), false); //失败\r\n      this.addEventListener('abort', ajaxEnd('abort'), false); //取消\r\n\r\n      return _originSend.apply(this, arguments)\r\n    }\r\n  }\r\n}","import perf from './perf'\r\nimport resource from './resource'\r\nimport errorCatch from './errorCatch'\r\nimport xhrHook from './xhrHook'\r\n\r\n\r\n//性能指标\r\n// perf.init((perfData)=>{\r\n//   //performance timing\r\n//   // console.log('perfData: ', perfData);\r\n//   // console.log('perf init')\r\n// })\r\n\r\n//资源监控\r\n// resource.init((resource)=>{\r\n//   console.log('resource: ', resource);\r\n// })\r\n\r\n//请求监控\r\n// console.log('xhrHook: ', xhrHook);\r\nxhrHook.init((infoData)=>{\r\n  console.log('infoData: ', infoData);\r\n})\r\n\r\n//错误捕获\r\n// errorCatch.init(()=>{\r\n//   console.log('errorCatch init')\r\n// })"],"names":["init","cb","console","log","xhr","window","XMLHttpRequest","_yy_monitor_flag","_originOpen","prototype","open","method","url","async","user","password","_yy_xhr_info","status","apply","arguments","_originSend","send","value","_self","_yy_start_time","Date","now","ajaxEnd","eventType","response","responseSize","responseType","JSON","stringify","length","byteLength","responseText","event","success","duration","requestSize","type","addEventListener","xhrHook","infoData"],"mappings":";;;;;EAAA;;AAEA,gBAAe;EACbA,QAAM,cAACC,EAAD,EAAQ;EACZC,YAAQC,GAAR,CAAY,GAAZ;EACA;EACA,QAAIC,MAAMC,OAAOC,cAAjB;EACA,QAAIF,IAAIG,gBAAJ,KAAyB,IAA7B,EAAmC;EACjC;EACD;EACDH,QAAIG,gBAAJ,GAAuB,IAAvB;;EAEA;EACA,QAAIC,cAAcJ,IAAIK,SAAJ,CAAcC,IAAhC;EACAN,QAAIK,SAAJ,CAAcC,IAAd,GAAqB,UAAUC,MAAV,EAAkBC,GAAlB,EAAuBC,KAAvB,EAA8BC,IAA9B,EAAoCC,QAApC,EAA8C;EACjE;EACA,WAAKC,YAAL,GAAoB;EAClBL,sBADkB;EAElBC,gBAFkB;EAGlBK,gBAAQ;EAHU,OAApB;EAKA,aAAOT,YAAYU,KAAZ,CAAkB,IAAlB,EAAwBC,SAAxB,CAAP;EACD,KARD;;EAUA;EACA,QAAIC,cAAchB,IAAIK,SAAJ,CAAcY,IAAhC;EACAjB,QAAIK,SAAJ,CAAcY,IAAd,GAAqB,UAAUC,KAAV,EAAiB;EACpC,UAAIC,QAAQ,IAAZ;EACA,WAAKC,cAAL,GAAsBC,KAAKC,GAAL,EAAtB;;EAEA,UAAMC,UAAU,SAAVA,OAAU,CAACC,SAAD;EAAA,eAAe,YAAM;EACnC,cAAIL,MAAMM,QAAV,EAAoB;EAClB,gBAAIC,eAAe,IAAnB;EACA,oBAAQP,MAAMQ,YAAd;EACE,mBAAK,MAAL;EACE;EACAD,+BAAeE,KAAKC,SAAL,CAAeV,MAAMM,QAArB,EAA+BK,MAA9C;EACA;EACF,mBAAK,aAAL;EACEJ,+BAAeP,MAAMM,QAAN,CAAeM,UAA9B;EACA;EACF;EACEL,+BAAeP,MAAMa,YAAN,CAAmBF,MAAlC;EACA;EAVJ;EAYA;EACAX,kBAAMP,YAAN,CAAmBqB,KAAnB,GAA2BT,SAA3B;EACAL,kBAAMP,YAAN,CAAmBC,MAAnB,GAA4BM,MAAMN,MAAlC;EACAM,kBAAMP,YAAN,CAAmBsB,OAAnB,GAA6Bf,MAAMN,MAAN,KAAiB,GAA9C;EACAM,kBAAMP,YAAN,CAAmBuB,QAAnB,GAA8Bd,KAAKC,GAAL,KAAaH,MAAMC,cAAjD;EACAD,kBAAMP,YAAN,CAAmBc,YAAnB,GAAkCA,YAAlC;EACAP,kBAAMP,YAAN,CAAmBwB,WAAnB,GAAiClB,QAAQA,MAAMY,MAAd,GAAuB,CAAxD,CApBkB;EAqBlBX,kBAAMP,YAAN,CAAmByB,IAAnB,GAA0B,KAA1B;;EAEA;EACAxC,eAAGsB,MAAMP,YAAT;EAED;EACF,SA5Be;EAAA,OAAhB;;EA8BA;EACA,WAAK0B,gBAAL,CAAsB,MAAtB,EAA8Bf,QAAQ,MAAR,CAA9B,EAA+C,KAA/C,EAnCoC;EAoCpC,WAAKe,gBAAL,CAAsB,OAAtB,EAA+Bf,QAAQ,OAAR,CAA/B,EAAiD,KAAjD,EApCoC;EAqCpC,WAAKe,gBAAL,CAAsB,OAAtB,EAA+Bf,QAAQ,OAAR,CAA/B,EAAiD,KAAjD,EArCoC;;EAuCpC,aAAOP,YAAYF,KAAZ,CAAkB,IAAlB,EAAwBC,SAAxB,CAAP;EACD,KAxCD;EAyCD;EAjEY,CAAf;;ECIA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;;EAEA;EACA;EACAwB,QAAQ3C,IAAR,CAAa,UAAC4C,QAAD,EAAY;EACvB1C,UAAQC,GAAR,CAAY,YAAZ,EAA0ByC,QAA1B;EACD,CAFD;;EAIA;EACA;EACA;EACA;;;;;;"}